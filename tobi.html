<!DOCTYPE html>
<html>
  
  <title>The Tech & Effects Behind ToBI</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:400,600,800|Open+Sans:400,600">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="icon" type="image/png" href="content/favicon.ico">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  
  <style>
  
    h1,h2,h3,h4,h5 { font-family: "Poppins", sans-serif; line-height: 90%; }
    h1 { font-size: 60px; font-weight: 800; padding-bottom: 0.25em; }
    h2 { font-size: 30px; font-weight: 600; }
    h3 { font-size: 20px; font-weight: 400; }
    body { font-family: "Open Sans", sans-serif; font-size: 15px; }
    a { font-family: "Open Sans", sans-serif; font-weight: 600; color: #E91E63; }
    
    hr {
      border-width: 4px;
      border-color: #E1ECF3;
      padding: 0px;
      margin: 0px;
    }
    
    .small {
      color: #FFFFFF;
      font-size: 13px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .contained-text {
      width: 50%;
      padding: 50px;
      float: left;
      overflow: hidden;
    }
        
    .contained-images {
      width: 50%;
      padding: 15px;
      padding-top: 6.5em;
      float: left;
      overflow: hidden;
    }
    
    .clear {
      clear: both;
    }
    
    img,video {
      max-width: 100%;
      max-height: 100%;
      padding: 0px;
      margin: 0px;
    }
    
  </style>
  
  <body>
  
    <!----------------------------------------------------------------------------->
    <!--------------------------------------------------------------------- HERO -->
    <!----------------------------------------------------------------------------->
  
    <div style="background: linear-gradient(90deg, #EAF4F5 0%, #FFFFFF 10%, #FFFFFF 50%, #E1ECF3 50%)">
      <div class="container">
      
        <div class="contained-text">
          <br><br><br><br><h2>the tech & effects behind</h2>
          <h1 style="font-size:80px; color:#E91E63;">TROUBLE ON BERYL ISLE</h1>
          <br>
          <p>Hey! If you're reading this, you might be a fellow gamedev wondering what I did to make this project possible. It's great to meet you!</p>
          <p>This article is a detailed breakdown of the tools, systems, characters, and effects  I did for ToBI over a year of development — from doodling on notebook paper to presenting the game at DreamHack Atlanta.</p>
          <p>I've linked to code samples and assets throughout, but if you're curious about anything in the game I don't cover here, feel free to <a href="mailto:sflanagan33@gatech.edu?subject=Inquiry">contact me</a>!</p>
        </div>

        <div class="contained-images">
          <img src="tobi/hero.png" style="width: 100%;">
        </div>
        
        <div class="clear"></div>
        
      </div>
    </div>
    
    <!----------------------------------------------------------------------------->
    <!------------------------------------------------------------- EDITOR TOOLS -->
    <!----------------------------------------------------------------------------->
  
    <hr>
    <div style="background: linear-gradient(90deg, #EAF4F5 0%, #FFFFFF 10%, #FFFFFF 50%, #E91E63 50%)">
      <div class="container">
      
        <!------------------------------------------------------------- HEADER -->
        
        <div class="contained-text">
          <h1 style="color:#E91E63;">EDITOR TOOLS</h1>
          <p>I pitched Trouble on Beryl Isle as a streaming, open-world adventure, which is about the highest form of hubris a student game project might be capable of. But thanks to a set of editor tools and workflows I developed during pre-production (along with a <i>lot</i> of dedication from everyone on the content side of things) we were able to pull off something remarkably close to that original concept.</p>
        </div>
        
        <div class="contained-images">
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- PROCEDURAL POLYGONS -->
        
        <div class="contained-text">
          <h2>Procedural Polygons</h2>
          <p>So — how do you make a game that takes place in a city without a big team of environment artists? From the beginning, it seemed obvious that the scale I was imagining for Beryl Isle would preclude us from modeling everything by hand. Instead, I wanted to develop a tool that would let us build convincingly-artpassed geometry directly inside the Unity editor.</p>
          <p>Enter the <b>procedural polygon</b>, the geometry blocking tool that made the game possible. By dragging around some points and applying a style, a simple 2D shape can become anything your heart desires.</p>
          <p>Said in a less cutesy tone, this is a procedural mesh generator that was used to make 99% of the game's geometry. Conceptually, it's like the lathe or spin tool in most modeling programs. A polygon "style" is a marked-up edge silhouette that defines any angles or bevels on the polygon, and assigns which materials are used where. The generation algorithm takes that silhouette, extrudes it around the given 2D shape, and optionally closes off the top and bottom for you.</p>
          <p>I made 21 polygon styles in total, for various surface needs like grass, Spanish tile, brick, metal siding, and glass. The actual materials and textures used on the styles I created with Substance Designer.</p>
          <p>I found out later that this is more or less the same workflow that Insomniac Games used to make the buildings in <i>Spider-Man</i> — a polyline tool that lets you define the core shapes of buildings, and then modularly beautifies them for you with predefined bevels and textures.</p>
          <p>You can check out the complete source code for the tool in the <a href="https://github.com/sflanagan33/ToBI-Samples/tree/master/Procedural" target="_blank">ToBI sample repository</a>. One of the other programmers on the team also extended the tool with the ability to mirror and scale shapes.</p>
        </div>
        
        <div class="contained-images">
          <video autoplay muted loop><source src="tobi/procedural-polygon.mp4" type="video/mp4"></video>
          <video autoplay muted loop style="margin-top:-8px"><source src="tobi/procedural-polygon-2.mp4" type="video/mp4"></video>
          <img src="tobi/procedural-materials.png" style="width: 100%; margin-top:-8px">
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- OPEN-WORLD EDITING -->
        
        <div class="contained-text">
          <h2>Open-World Editing</h2>
          <p>Having a quick way to make buildings is good, but that's only half of the problem. Since Beryl Isle is one large, contiguous playspace, I needed a way to split it up into smaller chunks — both for performance reasons, and to allow the team to build freely without fear of merge conflicts.</p>
          <p>The solution was another editor workflow, which takes advantage of Unity's additive scene loading. All of the scenes saved within a specific asset folder are called <b>world areas</b>, each containing a human-intuitive portion of Beryl Isle (usually, a building or group of buildings designed by one person.)</p>
          <p>Whenever one of these scenes is saved in the Unity editor, my scripts automatically generate a corresponding <b>world area prefab</b>, with a LOD model of the scene geometry and a loading zone surrounding it. All of these prefabs are then placed in the Beryl Isle base scene, which houses everything common to the island (lighting, ambience, skybox, etc.) As you run around in that base scene, the prefabs check where you are and additively load / unload their corresponding scenes.</p>
          <p>This workflow also meshed really well with the procedural polygon tool: since most of the geometry in the game is procedurally generated, these scripts can automatically make accurate scene LODs by running that same code with the settings turned all the way down.</p>
          <p>Overall, I'm happy with how this workflow came out — it made everything from large-scale collaboration to small scene fixes very painless throughout development. If I were to iterate on it more, I'd move away from using axis-aligned bounding boxes as loading zones, since they didn't always intuitively capture the extent of an area.</p>
          <p>You can check out the editor scripts behind all of this in the <a href="https://github.com/sflanagan33/ToBI-Samples/tree/master/World" target="_blank">ToBI sample repository</a>.</p>
        </div>
        
        <div class="contained-images" style="text-align: center">
          <video autoplay muted loop><source src="tobi/open-world.mp4" type="video/mp4"></video>
          <video autoplay muted loop style="margin-top:-8px"><source src="tobi/open-world-2.mp4" type="video/mp4"></video>
          <p class="small">click on prefab → open scene → make changes → save / close scene → prefab updates!</p>
        </div>
        
        <div class="clear"></div>
        
      </div>
    </div>
    
    <!----------------------------------------------------------------------------->
    <!--------------------------------------------------- CHARACTERS & ANIMATION -->
    <!----------------------------------------------------------------------------->
  
    <hr>
    <div style="background: linear-gradient(90deg, #EAF4F5 0%, #FFFFFF 10%, #FFFFFF 50%, #FFC107 50%)">
      <div class="container">
      
        <!------------------------------------------------------------- HEADER -->
        
        <div class="contained-text">
          <h1 style="color: #FFC107">CHARACTERS & ANIMATION</h1>
          <p>One of my personal goals on ToBI was to design and implement a fully hand-animated main character, which I hadn't done before this project. That goal took the form of Luke the Wolf, a modern take on a retro mascot character with a fluid, fun moveset.</p>
        </div>
        
        <div class="contained-images">
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- STATES -->
         
        <div class="contained-text">
          <h2>Hierarchical States</h2>
          <p>Text text text.</p>
          <p>The other members of my team used this same system to implement their own characters and enemies — a football ram, an exploding frog, an alien saucer, a flamingo, and even the cars that drive around the island.</p>
        </div>
        
        <div class="contained-images">
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- PROCEDURAL ANIMATION -->
         
        <div class="contained-text">
          <h2>Procedural Animation</h2>
          <p>Text text text.</p>
        </div>
        
        <div class="contained-images">
        </div>
        
        <div class="clear"></div>
        
      </div>
    </div>
    
    <!----------------------------------------------------------------------------->
    <!------------------------------------------------------------ SHADERS & VFX -->
    <!----------------------------------------------------------------------------->
  
    <hr>
    <div style="background: linear-gradient(90deg, #EAF4F5 0%, #FFFFFF 10%, #FFFFFF 50%, #2196F3 50%)">
      <div class="container">
      
        <!------------------------------------------------------------- HEADER -->
        
        <div class="contained-text">
          <h1 style="color:#2196F3">SHADERS & VFX</h1>
          <p>ToBI was filled with opportunities for creative shader work. At the intersection of math and art design, VFX is one of my favorite areas of game development, and I've broken down how I made some of the most fun effects in the project below.</p>
        </div>
        
        <div class="contained-images">
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- EXPLOSIONS -->
        
        <div class="contained-text">
          <h2>Explosions</h2>
          <p>What kind of 3D platformer would ToBI be without red, beeping crates that blow you up? This explosion prefab consists of three particle systems, a shader, and a realtime light working together.</p>
          <p>The main body of the effect is a burst of sphere-mesh particles, which are quickly emitted from the explosion center and then drift upwards. These particles have a shader that rolls some <a href="https://en.wikipedia.org/wiki/Worley_noise" target="_blank">Worley noise</a> up their mesh, displacing their vertices and emitting HDR colors from a gradient sample. The shader also reads from the particles' vertex alpha to make them slowly "cool off" and vanish over time.</p>
          <p>The explosion is sweetened with two other particle systems: some bouncy trails and floating stars that get emitted from the center.</p>
          <p>For some added fun, Luke's shader also has a "soot damage" float uniform, which gets cranked up when he gets hit by an explosion. Toasty!</p>
          <p>You can check out the assets that go into the effect in the <a href="https://github.com/sflanagan33/ToBI-Samples/tree/master/Explosion" target="_blank">ToBI sample repository</a>.</p>
        </div>
        
        <div class="contained-images">
          <video autoplay muted loop><source src="tobi/explosion.mp4" type="video/mp4"></video>
          <img style="width:100%; margin-top:-8px" src="tobi/explosion-palette.png">
          <video autoplay muted loop style="float:left; width:58.4%;"><source src="tobi/explosion-particle.mp4" type="video/mp4"></video>
          <video autoplay muted loop style="float:left; width:41.6%"><source src="tobi/explosion-soot.mp4" type="video/mp4"></video>
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- USER INTERFACE -->
        
        <div class="contained-text">
          <h2>User Interface</h2>
          <p>ToBI's art direction is a sun-drenched, graffitipunk take on the <a href="https://www.google.com/search?q=memphis+style&tbm=isch" target="_blank">Memphis style</a> — a mashup of Sunset Overdrive, Miami's Art Deco district, and 90s Nickelodeon bumpers.</p>
          <p>The operating word for the interface was "fluid." When UI elements appear and disappear, they splatter onto the screen and evaporate off of it, powered by a shader that slowly scrolls a Memphis-inspired grunge pattern within various graffiti alphas.</p>
          <p>Strangely enough, my favorite VFX work I did in the game was for the pause & loading screens, where confetti particles gently drift through an implied fluid. On the pause screen, I used the stencil buffer to punch the particles' silhouettes through the central ribbon. The background is diagonally wiped in and out with an alpha cutoff.</p>
        </div>
        
        <div class="contained-images">
          <video autoplay muted loop style="margin-bottom:-8px"><source src="tobi/ui-pause.mp4" type="video/mp4"></video>
          <img style="width:25%; float:left;" src="tobi/ui-memphis.png">
          <img style="width:25%; float:left;" src="tobi/ui-splat-1.png">
          <img style="width:25%; float:left;" src="tobi/ui-splat-2.png">
          <img style="width:25%; float:left;" src="tobi/ui-palette.png">
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- ZAP -->
         
        <div class="contained-text">
          <h2>Zap</h2>
          <p>One fun effect that ended up going unused was an implementation of the quintessential "x-ray skeleton" for getting electrocuted, which was inspired by similar effects from other cartoony platformers.</p>
          <p>I modeled Luke's skeleton (to... an extent), made it flicker neon blue with a custom shader, and wrote another for his body that flips the culling and applies a matcap-style glow. A particle system draws a randomized ribbon of electricity arcing over him.</p>
          <p>This effect is actually still 100% functional in the final build — Luke's skeleton is always there, <i>lurking</i> — but none of the enemies or hazards in the game ended up using the electric damage type, so it's impossible to trigger. Game development!</p>
        </div>
        
        <div class="contained-images">
          <video autoplay muted loop><source src="tobi/zap.mp4" type="video/mp4"></video>
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- WATER -->
        
        <div class="contained-text">
          <h2>Water</h2>
          <p>Water is usually the most complicated bit of tech art in every game I make, and this time was no different. The water in ToBI consists of a surface shader, a simulation shader, six textures, and a single water material that brings all of them together.</p>
          <p>Making things even more complicated, the open-world design of the game requires the water material to look convincing and non-repetitive at very different scales — both when the camera is practically on top of it, and when viewing it from a rooftop several kilometers away.</p>
          <p>Let's go through the solution step by step!</p>
        </div>
        
        <div class="contained-images">
          <video autoplay muted loop><source src="tobi/water.mp4" type="video/mp4"></video>
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- WATER . MODELING -->
         
        <div class="contained-text">
          <h3>Modeling</h3>
          <p>First off, we need something to apply the water material to. The ocean in ToBI is the  boundary of the playspace, and was specifically modeled to line up with the various beaches and outcrops of Beryl Isle. While this was manual work, it ended up being necessary for performance reasons (I didn't want an expensive water plane being rendered underneath everything in the city) and also gave me fine-grained control over the poly density.</p>
          <p>Of course, you can also slap the same water material on a procedural polygon, which was useful for making swimming pools, fountains, aqueducts, and whatever else.</p>
        </div>
        
        <div class="contained-images">
          <img src="tobi/water-model.png">
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- WATER . COLORATION -->
        
        <div class="contained-text">
          <h3>Coloration</h3>
          <p>The water surface shader does a lot, but the very first part of the look is its coloration gradient. Using <a href="https://docs.unity3d.com/Manual/SL-GrabPass.html" target="_blank">GrabPass</a>, the surface shader nabs the prior contents of the screen, figures out how close each pixel is to the water surface with a depth buffer comparison, and then recolors each pixel with a gradient sample. The shader also lets you configure how deep the gradient penetrates into the water (see right.)</p>
          <p>To get a richer, more consistent palette, everything underwater is turned grayscale before being multiplied with its new water color.</p>
          <p>If the water is extremely shallow, some bright white "foam" is also brought into the albedo, which makes for a nice edge highlight.</p>
        </div>
        
        <div class="contained-images">
          <img src="tobi/water-palette.png" style="width:100%;"><p></p>
          <video autoplay muted loop><source src="tobi/water-palette.mp4" type="video/mp4"></video>
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- WATER . CAUSTICS -->
        
        <div class="contained-text">
          <h3>Caustics</h3>
          <p>The next part of the surface shader is a shimmering layer of caustics, which adds a lot to the appeal. Though the caustics look like they're being drawn onto the submerged geometry, they're actually on the surface of the water.</p>
          <p>Using some wacky projection math, we can reconstruct world space from the depth buffer, figure out where the submerged geometry is, and use its position to project some UV coordinates from the sun.</p>
          <p>The caustics (which are just two copies of that texture scrolling past each other) are then added to the emission of the water surface.</p>
        </div>
        
        <div class="contained-images">
          <video style="float: left; width:43.75%" autoplay muted loop><source src="tobi/water-caustics.mp4" type="video/mp4"></video>
          <img style="float: left; width:56.25%" src="tobi/water-caustics.png">
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- SIMULATION -->
        
        <div class="contained-text">
          <h3>Simulation & Tesselation</h3>
          <p>ToBI's water is also a dynamic local simulation — when Luke moves or swims around in any body of water, he realistically displaces its surface.</p>
          <p>This is where that simulation shader comes in. At all times, a 256x256 texture is sitting in memory as the "water simulation buffer", with its red channel representing surface displacement and its green channel representing surface velocity (see in-game comparison at right.)</p>
          <p>When Luke moves around, a script tells the simulation shader to write some negative velocity at his current position (the texture is mapped in world space.) The shader then runs the "simulation tick", where a little bit of ambient velocity is applied from a scrolling texture, and all velocities get propagated to adjacent pixels using Hooke's law.</p>
          <p>Finally, the surface shader reads from that buffer to displace its vertices, adjust its normals, and refract what it's pulling from the GrabPass. It also uses <a href="https://docs.unity3d.com/Manual/SL-SurfaceShaderTessellation.html" target="_blank">Unity's edge-length tesselation</a> to get a respectable poly density for close-up viewing.</p>
          <p>As far as I can tell, this is the same general technique used to simulate all of the fluid and local fog in <em>Super Mario Odyssey</em>.</p>
        </div>
        
        <div class="contained-images">
          <video autoplay muted loop><source src="tobi/water-simulation.mp4" type="video/mp4"></video>
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- LOD -->
        
        <div class="contained-text">
          <h3>Level of Detail</h3>
          <p>Obviously, nobody has the VRAM to simulate an entire ocean like that, so this is where LOD tricks come into play. After a certain distance, the detailed displacement-and-velocity "near simulation" starts to fade into a much simpler "far simulation", which is basically just the classic "scroll some normal maps over each other" trick for making cheap water. This is the version of the water you're looking at from the tops of buildings.</p>
          <p>This also ended up being one of those situations where putting an execution branch in a shader was worth it. Computing the normals for the near simulation is extremely expensive per-pixel, and having the surface shader completely bypass those lines upon reaching the far LOD made it much more performant, given how much distant ocean is usually onscreen.</p>
          <p>While overall I'm really happy with how the water in ToBI turned out, in future games I'd like to focus more on doing surface foam and impact particles to really sell the water interacting with objects.</p>
          <p>You can check out the assets and shaders that go into the effect in the <a href="https://github.com/sflanagan33/ToBI-Samples/tree/master/Water" target="_blank">ToBI sample repository</a>.</p>
        </div>
        
        <div class="contained-images">
          <img src="tobi/water-lod.png">
        </div>
        
        <div class="clear"></div>
        
      </div>
    </div>
    
    <!----------------------------------------------------------------------------->
    <!------------------------------------------------------------------- FOOTER -->
    <!----------------------------------------------------------------------------->
  
    <hr>
    <div style="background: linear-gradient(90deg, #EAF4F5 0%, #FFFFFF 10%, #FFFFFF 50%, #E1ECF3 50%)">
      <div class="container">
      
        <div class="contained-text">
          <h1>CLOSING THOUGHTS</h1>
          <p>I learned a ton from working on this project for a year - </p>
        </div>
        
        <div class="contained-images">
          <img src="tobi/luke.png">
        </div>
        
        <div class="clear"></div>
        <br><br><br><br>
        
      </div>
    </div>

  </body>
  
</html>