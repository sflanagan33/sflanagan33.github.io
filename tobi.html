<!DOCTYPE html>
<html>
  
  <title>ToBI Breakdown</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:400,600,800|Open+Sans:400,600">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="icon" type="image/png" href="content/favicon.ico">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  
  <style>
  
    h1,h2,h3,h4,h5 { font-family: "Poppins", sans-serif; line-height: 90%; }
    h1 { font-size: 60px; font-weight: 800; padding-bottom: 0.25em; }
    h2 { font-size: 30px; font-weight: 600; }
    h3 { font-size: 20px; font-weight: 400; }
    body { font-family: "Open Sans", sans-serif; font-size: 15px; }
    a { font-family: "Open Sans", sans-serif; font-weight: 600; color: #E91E63; }
    
    hr {
      border-width: 4px;
      border-color: #E1ECF3;
      padding: 0px;
      margin: 0px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .contained-text {
      width: 50%;
      padding: 50px;
      float: left;
      overflow: hidden;
    }
        
    .contained-images {
      width: 50%;
      padding: 15px;
      padding-top: 6.5em;
      float: left;
      overflow: hidden;
    }
    
    .clear {
      clear: both;
    }
    
    img,video {
      max-width: 100%;
      max-height: 100%;
      padding: 0px;
      margin: 0px;
    }
    
  </style>
  
  <body>
  
    <!----------------------------------------------------------------------------->
    <!--------------------------------------------------------------------- HERO -->
    <!----------------------------------------------------------------------------->
  
    <div style="background: linear-gradient(90deg, #EAF4F5 0%, #FFFFFF 10%, #FFFFFF 50%, #E1ECF3 50%)">
      <div class="container">
      
        <div class="contained-text">
          <br><br><br><br><h2>the tech & effects behind</h2>
          <h1 style="font-size:80px; color:#E91E63;">TROUBLE ON BERYL ISLE</h1>
          <br>
          <p>Hey! If you're here, you're probably wondering what kind of work I put into making this project happen. Text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text.</p>
        </div>
        
        <div class="contained-images">
        </div>
        
        <div class="clear"></div>
        
      </div>
    </div>
    
    <!----------------------------------------------------------------------------->
    <!------------------------------------------------------------- EDITOR TOOLS -->
    <!----------------------------------------------------------------------------->
  
    <hr>
    <div style="background: linear-gradient(90deg, #EAF4F5 0%, #FFFFFF 10%, #FFFFFF 50%, #E91E63 50%)">
      <div class="container">
      
        <!------------------------------------------------------------- HEADER -->
        
        <div class="contained-text">
          <h1 style="color:#E91E63;">EDITOR TOOLS</h1>
          <p>Trouble on Beryl Isle was pitched as a streaming, open-world game, which is about the highest level of hubris a student project might hope to achieve. But we managed to pull it off — in large part due to a swath of editor tools and workflows which I developed during pre-production.</p>
        </div>
        
        <div class="contained-images">
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- PROCEDURAL POLYGONS -->
        
        <div class="contained-text">
          <h2>Procedural Polygons</h2>
        </div>
        
        <div class="contained-images">
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- OPEN-WORLD EDITING -->
        
        <div class="contained-text">
          <h2>Open-World Editing</h2>
        </div>
        
        <div class="contained-images">
        </div>
        
        <div class="clear"></div>
        
      </div>
    </div>
    
    <!----------------------------------------------------------------------------->
    <!------------------------------------------------------------ SHADERS & VFX -->
    <!----------------------------------------------------------------------------->
  
    <hr>
    <div style="background: linear-gradient(90deg, #EAF4F5 0%, #FFFFFF 10%, #FFFFFF 50%, #2196F3 50%)">
      <div class="container">
      
        <!------------------------------------------------------------- HEADER -->
        
        <div class="contained-text">
          <h1 style="color:#2196F3">SHADERS & VFX</h1>
          <p>ToBI was filled with opportunities for creative shader work. Text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text.</p>
        </div>
        
        <div class="contained-images">
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- WATER -->
        
        <div class="contained-text">
          <h2>Water</h2>
          <p>Water is usually the most complicated bit of tech art in every game I make, and this time was no different. The water in ToBI consists of a surface shader, a simulation shader, six textures, and a single water material that brings all of them together.</p>
          <p>Making things even more complicated, the open-world design of the game requires the water material to look convincing and non-repetitive at very different scales — both when the camera is practically on top of it, and when viewing it from a rooftop several kilometers away.</p>
          <p>Let's go through the solution step by step!</p>
        </div>
        
        <div class="contained-images">
          <video autoplay muted loop><source src="tobi/water.mp4" type="video/mp4"></video>
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- WATER . MODELING -->
         
        <div class="contained-text">
          <h3>Modeling</h3>
          <p>First off, we need something to apply the water material to. The ocean in ToBI is the  boundary of the playspace, and was specifically modeled to line up with the various beaches and outcrops of Beryl Isle. While this was manual work, it ended up being necessary for performance reasons (I didn't want an expensive water plane being rendered underneath everything in the city) and also gave me fine-grained control over the poly density.</p>
          <p>Of course, you can also slap the same water material on a procedural polygon, which was useful for making swimming pools, fountains, aqueducts, and whatever else.</p>
        </div>
        
        <div class="contained-images">
          <img src="tobi/water-model.png">
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- WATER . COLORATION -->
        
        <div class="contained-text">
          <h3>Coloration</h3>
          <p>The water surface shader does a lot, but the very first part of the look is its coloration gradient. Using <a href="https://docs.unity3d.com/Manual/SL-GrabPass.html" target="_blank">GrabPass</a>, the surface shader nabs the prior contents of the screen, figures out how close each pixel is to the water surface with a depth buffer comparison, and then recolors each pixel with a gradient sample. The shader also lets you configure how deep the gradient penetrates into the water (see right.)</p>
          <p>To get a richer, more consistent palette, everything underwater is turned grayscale before being multiplied with its new water color.</p>
          <p>If the water is extremely shallow, some bright white "foam" is also brought into the albedo, which makes for a nice edge highlight.</p>
        </div>
        
        <div class="contained-images">
          <img src="tobi/water-palette.png" style="width:100%;"><p></p>
          <video autoplay muted loop><source src="tobi/water-palette.mp4" type="video/mp4"></video>
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- WATER . CAUSTICS -->
        
        <div class="contained-text">
          <h3>Caustics</h3>
          <p>The next part of the surface shader is a shimmering layer of caustics, which adds a lot to the appeal. Though the caustics look like they're being drawn onto the submerged geometry, they're actually on the surface of the water.</p>
          <p>Using some wacky projection math, we can reconstruct world space from the depth buffer, figuring out where the submerged geometry is and using its position to project some UV coordinates from the sun.</p>
          <p>The caustics (which are just two copies of that texture scrolling past each other) are then added to the emission of the water surface.</p>
        </div>
        
        <div class="contained-images">
          <video style="float: left; width:43.75%" autoplay muted loop><source src="tobi/water-caustics.mp4" type="video/mp4"></video>
          <img style="float: left; width:56.25%" src="tobi/water-caustics.png">
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- SIMULATION -->
        
        <div class="contained-text">
          <h3>Simulation & Tesselation</h3>
          <p>ToBI's water is also a dynamic local simulation — when Luke moves or swims around in any body of water, he realistically displaces its surface.</p>
          <p>This is where that simulation shader comes in. At all times, a 256x256 texture is sitting in memory as the "water simulation buffer", with its red channel representing surface displacement and its green channel representing surface velocity (see in-game comparison at right.)</p>
          <p>When Luke moves around, a script tells the simulation shader to write some negative velocity at his current position (the texture is mapped in world space.) The shader then runs the "simulation tick", where a little bit of ambient velocity is applied from a scrolling texture, and all velocities get propagated to adjacent pixels using Hooke's law.</p>
          <p>Finally, the surface shader reads from that buffer to displace its vertices, adjust its normals, and refract what it's pulling from the GrabPass. It also uses <a href="https://docs.unity3d.com/Manual/SL-SurfaceShaderTessellation.html" target="_blank">Unity's edge-length tesselation</a> to get a respectable poly density for close-up viewing.</p>
          <p>As far as I can tell, this is the same general technique used to simulate all of the fluid and local fog in <em>Super Mario Odyssey</em>.</p>
        </div>
        
        <div class="contained-images">
          <video autoplay muted loop><source src="tobi/water-simulation.mp4" type="video/mp4"></video>
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- LOD -->
        
        <div class="contained-text">
          <h3>Level of Detail</h3>
          <p>Obviously, nobody has the VRAM to simulate an entire ocean like that, so this is where LOD tricks come into play. After a certain distance, the detailed displacement-and-velocity "near simulation" starts to fade into a much simpler "far simulation", which is basically just the classic "scroll some normal maps over each other" trick for making cheap water. This is the version of the water you're looking at from the tops of buildings.</p>
          <p>This also ended up being one of those situations where putting an execution branch in a shader was worth it. Computing the normals for the near simulation is extremely expensive per-pixel, and having the surface shader completely bypass those lines upon reaching the far LOD made it much more performant, given how much distant ocean is usually onscreen.</p>
        </div>
        
        <div class="contained-images">
          <img src="tobi/water-lod.png">
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- EXPLOSIONS -->
        
        <div class="contained-text">
          <h2>Explosions</h2>
          <p>What kind of 3D adventure game would ToBI be without red, beeping crates that explode? This effect is created by a very specific particle system and a very specific shader working in tandem.</p>
          <p>For some added fun, Luke's shader also has a "soot damage" float uniform, which gets turned up when this damage type is detected and then decreased over time. Toasty!</p>
        </div>
        
        <div class="contained-images">
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- USER INTERFACE -->
        
        <div class="contained-text">
          <h2>User Interface</h2>
          <p>ToBI's art direction is a sun-drenched, graffitipunk take on the <a href="https://www.google.com/search?q=memphis+style&tbm=isch" target="_blank">Memphis Style</a> — kind of like Sunset Overdrive meets 90s Nickelodeon bumpers, but with more pastels. The operating word was "fluid" — when elements from the UI appear and disappear, they get spray-painted onto the screen and fade out in a similar way.</p>
        </div>
        
        <div class="contained-images">
        </div>
        
        <div class="clear"></div>
        
        <!------------------------------------------------------------- ZAP -->
         
        <div class="contained-text">
          <h2>Zap</h2>
          <p>One fun effect that ended up going unused was an implementation of the quintessential "x-ray skeleton" effect for Luke getting electrocuted, which was inspired by a similar effect in Super Mario Galaxy.</p>
          <p>I modeled Luke's skeleton (to.. an extent), made it glow, and also wrote a special shader / material for his body that flips the culling and applies a matcap-style glow. The glow is an addition of two dot products of the camera vector and the normal — a soft glow when they're near-parallel, and a bright glow when they're near-perpendicular.</p>
          <p>This effect is actually still 100% functional in the final build — Luke's skeleton is always there, lurking — but none of the enemies or hazards in the game ended up using the "Electric" damage type, so it's impossible to trigger. Game development!</p>
        </div>
        
        <div class="contained-images">
        </div>
        
        <div class="clear"></div>
        
      </div>
    </div>
    
    <!----------------------------------------------------------------------------->
    <!--------------------------------------------------- CHARACTERS & ANIMATION -->
    <!----------------------------------------------------------------------------->
  
    <hr>
    <div style="background: linear-gradient(90deg, #EAF4F5 0%, #FFFFFF 10%, #FFFFFF 50%, #FFC107 50%)">
      <div class="container">
      
        <div class="contained-text">
          <h1 style="color: #FFC107">CHARACTERS & ANIMATION</h1>
          <p>Blah blah blah</p>
        </div>
        
        <div class="contained-images">
        </div>
        
        <div class="clear"></div>
        
      </div>
    </div>

  </body>
  
</html>